{"componentChunkName":"component---src-templates-post-js","path":"/posts/getting-api-data-into-your-templates-with-django","result":{"data":{"contentfulPost":{"title":"Getting API into your templates with Django","date":"September 1st, 2019","content":{"childMarkdownRemark":{"html":"<p>It started by giving myself a project. Building a dashboard for our Customer Success team, bringing all our platforms into one UI. This, of course, meant I had to use APIs to populate the data. You can read about this more in depth <a href=\"https://developer.mrpbennett.com/projects/csm-portal\">here</a></p>\n<p>I started to build the dashboard using <a href=\"https://www.youtube.com/playlist?list=PL-osiE80TeTtoQCKZ03TU5fNfx2UY6U4p\">Corey Schafer Django Tutorials</a> on YouTube as I generally know more Python than anything else. Cory is the MAN!!! I have learnt so much from him, over anything else I have used included <a href=\"https://www.udemy.com\">Udemy</a>. Although I am not knocking Udemy, Cory is just an excellent teacher.</p>\n<p>Ok, so how did I end up getting my API responses into my template.</p>\n<h3>PostMan</h3>\n<p>Postman has now for me, became an invaluable tool. It allows me to test all my APIs before putting them into code. I can dig down into the response so I know what to pull.</p>\n<h3>Code</h3>\n<p>I now know what I want to get from the API and what <code>keys</code> to use to get the relevant data. Making an API call in Python is pretty straight forward using <a href=\"https://2.python-requests.org/en/master/\">Requests</a>. Something as simple as this will get you a response from an API.</p>\n<pre><code class=\"language-python\">import requests\n\ndef function():\n    url = 'https://swapi.co/api/starships/9/'\n    r = requests.get(url)\n    data = r.json()\n\n    return data\n</code></pre>\n<p>How did I get my API data into my templates? Well, this was where the headache came from, using Cory's tutorial I was coding blind more or less. As I was learning Django from those tutorials, so when it came to be doing my tweaks I struggled.</p>\n<p>In Cory's tutorial, we created a class called <code>PostDetailView</code> inherits from <code>DetailView</code>. This is where our client's data would live, the data was being populated from my model. I then had to create a separate file which would store my API calls, the calls would be as simple as the below: (<em>keys and domains removed for security</em>)</p>\n<pre><code class=\"language-python\">import requests\nimport json\nimport os\n\ndef jira_data():\n    url = 'https://domain.atlassian.net/rest/api/2/search?jql=project=CS'\n    r = requests.get(url, auth=(\n        'paulb@domain.com', 'JIRA_API_KEY'))\n    data = r.json()\n    return data\n\n\ndef pendo_data():\n    url = 'https://app.pendo.io/api/v1/aggregation'\n    headers = {\n        'x-pendo-integration-key': \"PENDO_API_KEY\",\n        'content-type': \"application/json\"\n    }\n\n    r = requests.get(url, headers=headers)\n    data = r.json()\n    first_visit = data['metadata']['auto']['firstvisit']\n    return first_visit\n</code></pre>\n<p>Nothing too complicated here...but how did I get the responses in my template? It was a major headache and a great learning curve for me, after being introduced to <code>render_to_response</code> function it was pretty easy to understand.</p>\n<h3>The class</h3>\n<p>I had the functions pulling the API data as I wanted in my separate file, now to get them to populate in my template. I had to use the <code>render_to_repsonse</code> function in my class to do this.</p>\n<pre><code class=\"language-python\">class PostDetailView(DetailView):\n    model = Post\n    template_name = 'clients/post_detail.html'\n\n    def render_to_response(self, context, **response_kwargs):\n        # pendo api\n        pendo_result = api_calls.pendo_data()\n        context['pendo_data'] = pendo_result\n\n        # jira api\n        jira_result = api_calls.jira_data()\n        context['jira_data'] = jira_result['issues']\n\n        return super().render_to_response(context, **response_kwargs)\n</code></pre>\n<p>Using <a href=\"https://docs.djangoproject.com/en/2.2/ref/templates/api/#django.template.Context\"><code>context</code></a> to fill the data into the template.</p>\n<blockquote>\n<p>Once you have a compiled Template object, you can render a context with it. You can reuse the same template to render it several times with different contexts.</p>\n</blockquote>\n<p>The above functions, called the functions which were calling the APIs and then putting the response data into <code>context</code> so I was able to use a template expression to populate the data.</p>\n<h3>The template</h3>\n<p>Once I was able to get the data out from the APIs and into my views, the rest was pretty simple. YAY! I just had to use Jinga and some template expressions. I won't go into much detail about this step but to populate the data within my template and into my HTML I used the following expression <code>{{ pendo_data }}</code> or <code>{{ jira_data }}</code> this will then render what was returned by the functions.</p>","timeToRead":3}}}},"pageContext":{"slug":"getting-api-data-into-your-templates-with-django"}},"staticQueryHashes":["63159454"]}