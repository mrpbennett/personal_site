{"componentChunkName":"component---src-templates-post-js","path":"/posts/pagination-in-gatsby","result":{"data":{"contentfulPost":{"title":"Adding pagination in Gatsby","date":"October 12th, 2019","content":{"childMarkdownRemark":{"html":"<p>A page that displays your posts can get incredibly long as you continue to add posts. Pagination can offer a solution to having a massive list of posts, where it takes an age to scroll to the end of them.</p>\n<p>Pagination allows you to break up those posts into multiple, smaller pages.</p>\n<p>This tutorial was inspired by the post by Nicky Meuleman, I, however, had issues with it and couldn't get it to work. So this is my version of that tutorial.</p>\n<p>But first, why did I choose pagination over Infinite Scroll? I ended up picking pagination solely for the challenge of creating it. After reading the article <a href=\"https://uxplanet.org/ux-infinite-scrolling-vs-pagination-1030d29376f1\">UX: Infinite Scrolling vs. Pagination</a> I decided I made the right choice. Infinite scroll IMO is better suited to apps like Instagram.</p>\n<h3>Create a page for your posts.</h3>\n<p>Create a new file in <code>src/templates/</code> this will serve as a blueprint for every page that lists the posts. Make sure to import GraphQL and Link from Gatsby, and I have also imported my Layout and Head components too.</p>\n<pre><code class=\"language-javascript\">// src/templates/post-list.js\nimport React, { Component } from 'react'\nimport { Link, graphql } from 'gatsby'\n\nimport Layout from '../components/layout'\nimport Head from '../components/head'\n\nconst PostList = () => {\n    return (\n        &#x3C;Layout>\n            &#x3C;Head title=\"Posts\">\n            // - Posts Here\n        &#x3C;/Layout>\n    )\n}\n\nexport default PostList\n</code></pre>\n<p>Then you will need to get the post data inside the template using GraphQL below is the query I used. To learn more about GraphQL, you can watch the following videos.</p>\n<ul>\n<li><a href=\"https://www.youtube.com/watch?v=8t0vNu2fCCM&#x26;t=5303s\"> Gatsby Data with GraphQL - Andrew Mead</a></li>\n<li><a href=\"https://youtu.be/lAJWHHUz8_8\">GraphQL Basics - Fun Fun Function</a></li>\n</ul>\n<pre><code class=\"language-javascript\">// src/templates/post-list.js\nexport const query = graphql`\n    query($skip: Int!, $limit: Int!) {\n        allMarkdownRemark(\n            sort: { fields: [frontmatter___date], order: DESC }\n            limit: $limit\n            skip: $skip\n        ) {\n            edges {\n                node {\n                    fields {\n                        slug\n                    }\n                    frontmatter {\n                        title\n                        date(formatString: \"MMM DD, YYYY\")\n                    }\n                    excerpt(pruneLength: 280)\n                }\n            }\n        }\n    }\n`\n</code></pre>\n<p>It's time to populate the data into the template for this I am just going to copy my code. If you want to learn more about how it's filled using GraphQL, carry on watching the video by Andrew Mead.</p>\n<p>I also added <code>props</code> as a parameter to <code>PostList,</code> enabling me to get that data into my component.</p>\n<pre><code class=\"language-javascript\">// src/templates/post-list.js\nconst PostList = props => {\n    const posts = props.data.allMarkdownRemark.edges\n\n    return (...\n</code></pre>\n<p>Read more about React components and props <a href=\"https://reactjs.org/docs/components-and-props.html\">here</a></p>\n<pre><code class=\"language-javascript\">// src/templates/post-list.js\nconst PostList = props => {\n    const posts = props.data.allMarkdownRemark.edges\n\n    return (\n        &#x3C;Layout>\n            &#x3C;Head title=\"Posts\" />\n            &#x3C;div className={layoutStyles.pageHeader}>\n                &#x3C;h2>Posts&#x3C;/h2>\n                &#x3C;span>Just my ramberlings&#x3C;/span>\n            &#x3C;/div>\n            {posts.map(({ node }) => {\n                const title = node.frontmatter.title || node.fields.slug\n                return (\n                    &#x3C;div className={postPageStyles.postItem}>\n                        &#x3C;div className={postPageStyles.postItemTitle}>\n                            &#x3C;h2>{title}&#x3C;/h2>\n                            &#x3C;span>Posted on {node.frontmatter.date}&#x3C;/span>\n                        &#x3C;/div>\n                        &#x3C;div>\n                            &#x3C;p>{node.excerpt}&#x3C;/p>\n                            &#x3C;Link to={`${node.fields.slug}`}>\n                                &#x3C;span>Continue Reading&#x3C;/span>\n                                &#x3C;span role=\"img\"> ðŸ‘‰ðŸ¼&#x3C;/span>\n                            &#x3C;/Link>\n                        &#x3C;/div>\n                    &#x3C;/div>\n                )\n            })}\n        &#x3C;/Layout>\n    )\n}\n\nexport default PostList\n</code></pre>\n<h3>Get data to those listing pages</h3>\n<p>At this point, I am guessing you already have a collection of posts, and they're displayed as a giant list. I won't go over creating a slug for your <code>.md</code> files, if you don't, however, head over <a href=\"https://www.youtube.com/watch?v=8t0vNu2fCCM&#x26;t=8340s\">here</a> to learn more.</p>\n<p>The code below will create an amount of pages that is based on the total number of posts. . Each page will list <code>postsPerPage</code> (3) posts, until there are less than <code>postsPerPage</code> (3) posts left. The path for the first page is <code>/posts</code>, the following pages will have a path of the form: <code>/posts/2</code>, <code>/posts/3</code>, etc.</p>\n<p>This will also create a page for each post, each post will use the <code>post.js</code> template which you can find on my <a href=\"https://github.com/mrpbennett/gatsby-me/blob/master/src/templates/post.js\">repo</a>.</p>\n<pre><code class=\"language-javascript\">// gatsby-node.js\nmodule.exports.createPages = async ({ graphql, actions, reporter }) => {\n    const { createPage } = actions\n    const result = await graphql(`\n        query {\n            allMarkdownRemark {\n                edges {\n                    node {\n                        fields {\n                            slug\n                        }\n                    }\n                }\n            }\n        }\n    `)\n\n    // Handle errors\n    if (result.errors) {\n        reporter.panicOnBuild('Error while running GraphQL query.')\n        return\n    }\n\n    // Create the pages for each markdown file\n    const postTemplate = path.resolve('src/templates/post.js')\n    result.data.allMarkdownRemark.edges.forEach(({ node }) => {\n        createPage({\n            component: postTemplate,\n            path: `${node.fields.slug}`,\n            context: {\n                slug: node.fields.slug,\n            },\n        })\n    })\n\n    // PAGINATION FOR BLOG POSTS\n    const postsResult = await graphql(\n        `\n            {\n                allMarkdownRemark(\n                    sort: { fields: [frontmatter___date], order: DESC }\n                    limit: 1000\n                ) {\n                    edges {\n                        node {\n                            fields {\n                                slug\n                            }\n                        }\n                    }\n                }\n            }\n        `\n    )\n\n    if (postsResult.errors) {\n        reporter.panicOnBuild('Error while running GraphQL query.')\n        return\n    }\n\n    // Create blog-list pages\n    const posts = postsResult.data.allMarkdownRemark.edges\n    const postsPerPage = 3\n    const numPages = Math.ceil(posts.length / postsPerPage)\n    Array.from({ length: numPages }).forEach((_, i) => {\n        createPage({\n            path: i === 0 ? '/posts' : `/posts/${i + 1}`,\n            component: path.resolve('./src/templates/post-list.js'),\n            context: {\n                limit: postsPerPage,\n                skip: i * postsPerPage,\n                numPages,\n                currentPage: i + 1,\n            },\n        })\n    })\n}\n</code></pre>\n<h3>Adding previous/next navigation</h3>\n<p>This is where I ran to a dead end when using Nicky's tutorial. I was stuck <a href=\"https://nickymeuleman.netlify.com/blog/gatsby-pagination/#navigate-to-previousnext-page\">here</a>.</p>\n<p>As this was my first React project, I was unaware you were unable to use <a href=\"https://stackoverflow.com/questions/58318868/unable-to-use-const-within-a-class-in-react/58319086?noredirect=1#comment103005995_58319086\">const within a class in React</a></p>\n<p>I kept on getting an undefined error on <code>this.props.pageContext</code> after much headache, lots of dog walks, and two days later. I found the solution!! ðŸŽ‰</p>\n<p>I found it watching <a href=\"https://youtu.be/qcS1VCGWukU?t=238\">this video</a>. It was a simple case of using <code>const { currentPage, numPages } = props.pageContext</code>.</p>\n<p>Now my component looked like the below. With everything working now, you can use <code>currentPage</code> and <code>numPages</code> to determine the routes to the previous/next page. They also make it possible to only show those links if they exist.</p>\n<pre><code class=\"language-javascript\">// src/templates/post-list.js\nconst PostList = props => {\n    const { currentPage, numPages } = props.pageContext\n    const isFirst = currentPage === 1\n    const isLast = currentPage === numPages\n    const prevPage =\n        currentPage - 1 === 1\n            ? 'posts/'\n            : 'posts/' + (currentPage - 1).toString()\n    const nextPage = 'posts/' + (currentPage + 1).toString()\n\n    const posts = props.data.allMarkdownRemark.edges\n\n    return (\n        &#x3C;Layout>\n            {!isFirst &#x26;&#x26; (\n                &#x3C;Link to={prevPage} rel=\"prev\">\n                    â† Previous Page\n                &#x3C;/Link>\n            )}\n            {!isLast &#x26;&#x26; (\n                &#x3C;Link to={nextPage} rel=\"next\">\n                    Next Page â†’\n                &#x3C;/Link>\n            )}\n        &#x3C;/Layout>\n    )\n}\n</code></pre>\n<h3>Adding numbering</h3>\n<p>Iterate over <code>numPages</code> and output a number with the relevant link.</p>\n<pre><code class=\"language-javascript\">{\n    Array.from({ length: numPages }, (_, i) => (\n        &#x3C;Link key={`pagination-number${i + 1}`} to={`/${i === 0 ? '' : i + 1}`}>\n            {i + 1}\n        &#x3C;/Link>\n    ))\n}\n</code></pre>\n<p>I ended up placing all the pagination into it's own div enabling me to style it. This ended up looking like the below:</p>\n<pre><code class=\"language-html\">&#x3C;div className={paginationStyles.paginationBlock}>\n    &#x3C;div className={paginationStyles.previous}>\n        {!isFirst &#x26;&#x26; (\n            &#x3C;Link to={prevPage} rel=\"prev\">\n                &#x3C;span role=\"img\" className={paginationStyles.emojis}>\n                    ðŸ‘ˆðŸ¼\n                &#x3C;/span>\n            &#x3C;/Link>\n        )}\n    &#x3C;/div>\n\n    &#x3C;div className={paginationStyles.numbers}>\n        {Array.from({ length: numPages }, (_, i) => (\n            &#x3C;Link\n                key={`pagination-number${i + 1}`}\n                to={`posts/${i === 0 ? '' : i + 1}`}\n            >\n                {i + 1}\n            &#x3C;/Link>\n        ))}\n    &#x3C;/div>\n\n    &#x3C;div className={paginationStyles.next}>\n        {!isLast &#x26;&#x26; (\n            &#x3C;Link to={nextPage} rel=\"next\">\n                &#x3C;span role=\"img\" className={paginationStyles.emojis}>\n                    ðŸ‘‰ðŸ¼\n                &#x3C;/span>\n            &#x3C;/Link>\n        )}\n    &#x3C;/div>\n&#x3C;/div>\n</code></pre>\n<p>If this doesnt make any sense, I mean I am also new to Gatsby and React you can check out the relevant files to get the pagination working below:</p>\n<ul>\n<li><a href=\"https://github.com/mrpbennett/gatsby-me/blob/master/src/templates/post-list.js\">post-list.js</a></li>\n<li><a href=\"https://github.com/mrpbennett/gatsby-me/blob/master/gatsby-node.js\">gatsby-node.js</a></li>\n</ul>\n<p>The whole repo is also <a href=\"https://github.com/mrpbennett/gatsby-me\">here</a>.</p>\n<h4>Update:</h4>\n<p>I actually got in touch with Nicky over Twitter to advise him of the bug in his tutorial. This has now been resolved. However, i'll leave this blog post as it is, as a leaning curve.</p>","timeToRead":6}}}},"pageContext":{"slug":"pagination-in-gatsby"}},"staticQueryHashes":["63159454"]}