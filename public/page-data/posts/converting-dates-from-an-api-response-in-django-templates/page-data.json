{"componentChunkName":"component---src-templates-post-js","path":"/posts/converting-dates-from-an-api-response-in-django-templates","result":{"data":{"contentfulPost":{"title":"Converting dates from an API response in a Django Template","date":"September 2nd, 2019","content":{"childMarkdownRemark":{"html":"<p>As you might of read I struggled <a href=\"https://developer.mrpbennett.com/2019/09/02/getting-api-data-into-your-templates-with-django/\">getting data from an API</a> into my Django templates. Once I did I came across another issue, dates...bloody full formatted dates. Dates formats such as this: <code>2019-08-30T08:22:32.245-0700</code> this data format was how the API presented one of the fields I needed.</p>\n<p>How the hell could I convert it? I couldn't just use <a href=\"https://docs.python.org/2/library/datetime.html\"><code>datetime</code></a> So off to <a href=\"https://stackoverflow.com/questions/57759653/how-to-convert-date-from-an-api-response-in-a-django-template\">Stackoverflow</a> I went.</p>\n<p>As the brilliant @Ralf said if the data I retrieved from the API was a string and not a Python <code>datetime.datetime</code> object. I had 2 options:</p>\n<ul>\n<li>Custom template filter that converts string to date and formats it into a string with the desired format</li>\n<li>In your view convert strings to dates and format them into strings with the desired format</li>\n</ul>\n<p>The idea was to start creating a <a href=\"https://docs.djangoproject.com/en/2.2/howto/custom-template-tags/#writing-custom-template-filters\">custom template filter</a>. I copied the following from the source code from the <a href=\"https://docs.djangoproject.com/en/2.2/ref/templates/builtins/#date\">built-in date filter</a> so I was able to convert back to the date format I wanted, i ended up using <code>{{ custom_date:\"d/b/y\" }}</code></p>\n<p>I then went ahead and used the following to create a <a href=\"https://docs.djangoproject.com/en/2.2/howto/custom-template-tags/#code-layout\">custom template tag</a></p>\n<h3>Step 1</h3>\n<p>First I had to create a <code>templatetags</code> directory inside my app, at the same level as models.py, views.py, etc. I then had to create a <code>__init__.py</code> file to ensure the directory is treated as a Python package.</p>\n<p>Within the <code>templatetags</code> dir I created my <code>custom_date.py</code> which would hold my custom filter. So the app layout would look something like this:</p>\n<pre><code class=\"language-bash\">app/\n    __init__.py\n    models.py\n    templatetags/\n        __init__.py\n        custom_date.py\n    views.py\n</code></pre>\n<h3>Step 2</h3>\n<p>Now on to adding the filter into <code>custom_date.py</code> going back to my Stackoverflow question, I copied the example Ralf created. Which is the below</p>\n<pre><code class=\"language-python\">from django import template\nfrom django.utils import formats\nimport datetime\nregister = template.Library()\n\n\n@register.filter(expects_localtime=True, is_safe=False)\ndef custom_date(value, arg=None):\n    if value in (None, ''):\n        return ''\n\n    if isinstance(value, str):\n        api_date_format = '%Y-%m-%dT%H:%M:%S.%f%z'  # 2019-08-30T08:22:32.245-0700\n        value = datetime.datetime.strptime(value, api_date_format)\n\n    try:\n        return formats.date_format(value, arg)\n    except AttributeError:\n        try:\n            return format(value, arg)\n        except AttributeError:\n            return ''\n</code></pre>\n<p>I had some bugs with <code>api_date_format</code> because the API produced a whole load of extras I checked out the <a href=\"https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior\">datetstrftime() and strptime() Behavior table</a> and made some edits. Once I got rid of the errors I moved on to the template.</p>\n<p>First I had to load the custom filter into my template, then I used the <code>custom_date</code> to change it to what I needed.</p>\n<pre><code class=\"language-html\">{% raw %}\n&#x3C;td class=\"text-center\">{{ ticket.fields.updated|custom_date\"Y,D,M\" }}&#x3C;/td>\n{% endraw %}\n</code></pre>\n<p>And there we have it...I successfully formatted the date, from an API response string.</p>","timeToRead":3}}}},"pageContext":{"slug":"converting-dates-from-an-api-response-in-django-templates"}},"staticQueryHashes":["63159454"]}